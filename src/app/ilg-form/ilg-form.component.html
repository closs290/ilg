<mat-tab-group>
    <mat-tab label="Form">
        <div class="flex-container" style="font-family: 'Courier New', Courier, monospace;">
            <mat-card class="gloss-form-card">
                <mat-card-title>Create an interlinear text:</mat-card-title>

                <p style="font-size: x-small;">(Don't be afraid to leave blank fields; there are no required fields)</p>

                <form [formGroup]="interlinearGlossForm" class="gloss-form">
                    <mat-form-field appearance="outline" class="language">
                        <mat-label>Source Language</mat-label>
                        <input matInput formControlName="sourceLanguage">
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="dataset">
                        <mat-label>Dataset/Author</mat-label>
                        <input matInput formControlName="author">
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="year">
                        <mat-label>Year(:Page)</mat-label>
                        <input matInput formControlName="year">
                    </mat-form-field>
            
                    <br>
        
                    <div class="morpheme-gloss-pairs">
                        <table formArrayName="morphemeGlossMap">
                            <tr *ngIf="showOrthography.value">
                                <td *ngFor="let morph of morphs().controls; let i=index" [formGroupName]="i">
                                    <mat-form-field appearance="outline" class="ortho" id="ortho{{i}}">
                                        <input matInput formControlName="orthography"
                                                        type="text"
                                                        class="ortho"/>
                                        <mat-hint *ngIf="i===0">Orthography </mat-hint>
                                    </mat-form-field>
                                </td>
                            </tr>
                            <tr>
                                <td *ngFor="let morph of morphs().controls; let i=index" [formGroupName]="i">
                                    <mat-form-field title="{{interlinearGlossForm.value.morphemeGlossMap[i].morph}}"
                                                    appearance="outline" class="morpheme" id="morpheme{{i}}"
                                                    [ngStyle]="{'max-width.em': (interlinearGlossForm.value.morphemeGlossMap[i].morph.length > 5) ? 
                                                                (interlinearGlossForm.value.morphemeGlossMap[i].morph.length * .65) : 8 }">
                                        <mat-label>Morpheme</mat-label>
                                        <input matInput formControlName="morph"
                                                        type="text"
                                                        class="morphs"/>
                                    </mat-form-field>
                                </td>
                                <td rowspan="2">
                                    <button mat-mini-fab color="primary" type="button" (click)="addPair()" class="add-morpheme">
                                        <mat-icon>add</mat-icon>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td *ngFor="let morph of morphs().controls; let i=index" [formGroupName]="i">
                                    <mat-form-field title="{{interlinearGlossForm.value.morphemeGlossMap[i].gloss}}"
                                                    appearance="outline" class="gloss" id="gloss{{i}}">
                                        <mat-label>Gloss</mat-label>
                                        <input matInput [disabled]="false"
                                                        formControlName="gloss"
                                                        type="text"
                                                        class="glosses" />
                                    </mat-form-field>
                                    <mat-form-field class="abbreviation">
                                        <mat-label>Abbv</mat-label>
                                        <mat-select formControlName="abbreviation" 
                                                    title="Standard abbreviation for grammatical category"
                                                    style="font-variant: small-caps;">
                                            <mat-option *ngFor="let gloss of glossOptions" [value]="gloss.abbreviation" >
                                                <span style="font-variant: small-caps;"
                                                        title="{{gloss.full}}"
                                                >
                                                    {{gloss.abbreviation}}
                                                </span>
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                    <!-- <mat-form-field class="punctuation">
                                        <mat-select title="Boundary punctuation">
                                            <mat-option *ngFor="let punct of punctuationOptions" [value]="punct.grapheme" >
                                                <span title="{{punct.meaning}}">
                                                    {{punct.grapheme}}
                                                </span>
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field> -->
                                </td>
                            </tr>
                        </table>
                    </div>
            
                    <mat-form-field appearance="outline" class="freeTranslation">
                        <mat-label>Free Translation</mat-label>
                        <input matInput formControlName="freeTranslation">
                        <mat-hint>Natural language translation</mat-hint>
                    </mat-form-field>

                    <br><br>

                    <button mat-stroked-button color="primary" 
                            class="toggle-ortho"
                            title="Toggle orthography layer" 
                            (click)="toggleOrthoLayer()">
                        Orthography Layer
                    </button>
                    <mat-form-field>
                        <mat-label>Font</mat-label>
                        <mat-select formControlName="fontForm">
                            <mat-option *ngFor="let font of this.fonts" [value]="font.value" >
                                {{font.value}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
        
                    <br><br>
                    
                    <button mat-flat-button color="primary" (click)="submit()">Submit</button>
                    
                </form>
            </mat-card>
        </div>
        
        <mat-card>
            <mat-card-title>Formatted interlinear gloss:</mat-card-title>
            <table [style.font-family]="this.interlinearGlossForm.value.fontForm">
                <tr>
                    <td colspan="100">
                        <strong>{{this.interlinearGlossForm.value.sourceLanguage}}</strong> 
                        <span *ngIf="this.interlinearGlossForm.value.author || this.interlinearGlossForm.value.year">
                            ({{this.interlinearGlossForm.value.author}} {{this.interlinearGlossForm.value.year}}) 
                        </span>
                    </td>
                </tr>
                <tr *ngIf="showOrthography.value">
                    <td *ngFor="let pair of this.interlinearGlossForm.value.morphemeGlossMap"> 
                        <em>{{pair.orthography}} </em> 
                    </td>
                </tr>
                <tr>
                    <td *ngFor="let pair of this.interlinearGlossForm.value.morphemeGlossMap"> 
                        <em>{{pair.morph}} </em> 
                    </td>
                </tr>
                <tr>
                    <td *ngFor="let pair of this.interlinearGlossForm.value.morphemeGlossMap"> 
                        {{pair.gloss}}
                        <span style="font-variant: small-caps;">
                            {{pair.abbreviation}}
                        </span>
                    </td>
                    <!--Do something with small-caps abbr here-->
                </tr>
                <tr>
                    <td colspan="100">
                        <span *ngIf="this.interlinearGlossForm.value.freeTranslation">
                            "{{this.interlinearGlossForm.value.freeTranslation}}"
                        </span>
                    </td>
                </tr>
            </table>
        
        </mat-card>
        <mat-card>
            <p>Recommended citation: </p>
            <p>Closson, Reuben M. (2021). <em>Interliner Gloss Creator Web App</em> [Computer software], v. 1.5. Retrieved {{currDate | date}}, from http://ilg.closson.tech</p>
        </mat-card>
    </mat-tab>
    <mat-tab label="Library">
        <mat-card class="gloss-library-card">
            <mat-card-title>Glosses Created this Session:</mat-card-title>
            <table *ngFor="let ilg of ilgService.InterlinearGlossBank.getValue()"
                    [style.font-family]="this.interlinearGlossForm.value.fontForm">
                <tr>
                    <td colspan="100">
                        <strong>{{ilg.language}} </strong> 
                        <span *ngIf="ilg.author || ilg.year"> ({{ilg.author}} {{ilg.year}})</span>
                    </td>
                </tr>
                <tr *ngIf="ilg.phrases && this.showOrthography">
                    <td *ngFor="let pair of ilg.phrases">
                        <em>{{pair.orthography}}</em>
                    </td>
                </tr>
                <tr *ngIf="ilg.phrases">
                    <td *ngFor="let pair of ilg.phrases">
                        <em>{{pair.morph}}</em>
                    </td>
                </tr>
                <tr *ngIf="ilg.phrases">
                    <td *ngFor="let pair of ilg.phrases">
                        {{pair.gloss}}
                        <span style="font-variant: small-caps;">
                            {{pair.abbreviation}}
                        </span>
                    </td>
                </tr>
                <tr>
                    <td colspan="100">
                        <span *ngIf="ilg.freeTranslation">"{{ilg.freeTranslation}}"</span>
                    </td>
                </tr>
            </table>
        </mat-card>
        <mat-card>
            <p>Current font: {{this.interlinearGlossForm.value.fontForm}}</p>
            <p><strong>Recommended citation: </strong></p>
            <p [style.font-family]="this.interlinearGlossForm.value.fontForm">
                Closson, Reuben M. (2021). <em>Interliner Gloss Creator Web App</em> [Computer software], v. 1.5. Retrieved {{currDate | date}}, from http://ilg.closson.tech
            </p>
        </mat-card>
    </mat-tab>
</mat-tab-group>

